在学习 Makefile 和 Shell 脚本时，最容易产生混淆的地方就是这些以 `$` 开头的特殊变量。

它们虽然长得像，但**应用场景**、**生命周期**和**具体含义**完全不同。以下是详细的深度对比：

---

### 1. 核心定位对比

| 特性 | Makefile 自动化变量 | Shell 特殊变量 |
| :--- | :--- | :--- |
| **关注点** | **编译目标与依赖**（文件系统） | **进程执行与参数**（运行状态） |
| **触发时机** | 在规则的“配方”（Recipe）被解析时 | 命令执行过程中或执行结束后 |
| **代表对象** | 磁盘上的文件路径 | 内存中的参数、状态码、PID |

---

### 2. 符号重叠：含义完全不同
这是最坑的地方，同一个符号在两个环境下表达的意思南辕北辙。

#### **符号：`$@`**
*   **Makefile**: 指代**当前目标文件名**（Target）。
    *   *例子*：`main.o: main.c` 中，`$@` 就是 `main.o`。
*   **Shell**: 指代**所有传递给脚本/函数的参数列表**（且保留空格分隔）。
    *   *例子*：`./test.sh a b` 中，`$@` 是 `"a" "b"`。

#### **符号：`$?`**
*   **Makefile**: 指代**所有比目标文件更新的依赖文件列表**。
    *   *用途*：用于增量编译，只处理变动过的文件。
*   **Shell**: 指代**上一个命令的退出状态码**（Exit Status）。
    *   *用途*：判断命令是否执行成功（0 为成功）。

#### **符号：`$*`**
*   **Makefile**: 指代**模式匹配中的“茎”**（Stem）。
    *   *例子*：规则是 `%.o: %.c`，如果目标是 `foo.o`，则 `$*` 是 `foo`。
*   **Shell**: 指代**所有参数**（合并为一个字符串）。

---

### 3. Makefile 独有的“文件导向”变量
Makefile 的变量设计是为了方便写泛化规则，减少重复：

*   **`$<`**: 第一个依赖文件的名称。
*   **`$^`**: 所有依赖文件的名称（去重）。
*   **`$+`**: 所有依赖文件的名称（保留重复项，常用于链接库顺序）。

---

### 4. Shell 独有的“流程控制”变量
Shell 关注的是脚本如何被调用，以及后台运行情况：

*   **`$#`**: 参数的个数。
*   **`$0`**: 脚本文件本身的名称。
*   **`$1, $2...`**: 第1、第2个具体参数。
*   **`$$`**: 当前 Shell 进程的 PID（进程 ID）。
*   **`$!`**: 最近一个后台运行命令的 PID。

---

### 5. 交互冲突：在 Makefile 里使用 Shell 变量
这是初学者最常犯错的地方。因为 Makefile 的 Recipe（配方部分）本质上是交给 Shell 执行的，**如果 Makefile 发现 `$`，它会先尝试自己解析。**

#### **场景：我想在 Makefile 的命令里用 Shell 的环境变量或循环变量。**

*   **错误写法：**
    ```makefile
    test:
        for i in 1 2 3; do echo $i; done
    ```
    *后果*：Makefile 会试图寻找名为 `$i` 的 Makefile 变量，找不到就变为空字符串，最终 Shell 执行的是 `echo `，什么都不打印。

*   **正确写法（使用双 `$$`）：**
    ```makefile
    test:
        for i in 1 2 3; do echo $$i; done
    ```
    *原理*：在 Makefile 中，`$$` 表示一个字面意义上的 `$`。Makefile 把 `$$i` 传给 Shell 时，Shell 看到的是 `$i`，从而正确引用 Shell 变量。

---

### 总结对照表

| 符号       | 在 Makefile 里的意思 | 在 Shell 里的意思   |     |
| :------- | :-------------- | :------------- | --- |
| **`$@`** | **目标文件**        | **所有参数列表**     |     |
| **`$?`** | **更新过的依赖文件**    | **上个命令的状态码**   |     |
| **`$*`** | **模式匹配的中间部分**   | **所有参数(单字符串)** |     |
| **`$<`** | 第一个依赖文件         | (无特殊含义)        |     |
| **`$#`** | (无特殊含义)         | **参数个数**       |     |
| **`$$`** | 转义为单个 `$`       | **当前进程 PID**   |     |

**一句话记忆：**
Makefile 的变量是用来**找文件**的，Shell 的变量是用来**控进程**的。如果在 Makefile 规则里写 Shell 变量，记得多加一个 `$`。